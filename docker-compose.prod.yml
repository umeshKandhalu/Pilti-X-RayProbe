version: '3.8'

services:
  backend:
    # Pulls the pre-built image from GitHub Container Registry
    image: ghcr.io/umeshkandhalu/pilti-xrayprobe/backend:latest
    container_name: pilti-backend
    restart: always
    ports:
      - "8888:8080"
    environment:
      # In production, point to your actual MinIO/S3 server
      - MINIO_ENDPOINT=${MINIO_ENDPOINT}
      - MINIO_ACCESS_KEY=${MINIO_ACCESS_KEY}
      - MINIO_SECRET_KEY=${MINIO_SECRET_KEY}
      - MINIO_BUCKET_NAME=${MINIO_BUCKET_NAME}
      - MINIO_SECURE=${MINIO_SECURE:-False}
    volumes:
      - ./uploads:/app/uploads
      - ./reports:/app/reports
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8080/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - pilti-net

  frontend:
    # Pulls the pre-built image from GitHub Container Registry
    image: ghcr.io/umeshkandhalu/pilti-xrayprobe/frontend:latest
    container_name: pilti-frontend
    restart: always
    ports:
      - "80:80" # Standard web port
    depends_on:
      backend:
        condition: service_healthy
    networks:
      - pilti-net

networks:
  pilti-net:
    driver: bridge
